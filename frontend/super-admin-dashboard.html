<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AptioGen – Super Admin</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* ─── CSS Variables ──────────────────────────────────────────── */
    :root {
      --bg: #f0f4ff;
      --sidebar-bg: #0f172a;
      --sidebar-text: #94a3b8;
      --sidebar-active: #3b82f6;
      --sidebar-active-bg: rgba(59,130,246,0.12);
      --sidebar-hover: rgba(255,255,255,0.05);
      --card-bg: #ffffff;
      --border: #e2e8f0;
      --text-primary: #0f172a;
      --text-secondary: #64748b;
      --shadow: rgba(0,0,0,0.06);
      --input-bg: #ffffff;
      --input-border: #cbd5e1;
      --badge-bg: #f1f5f9;
      --topbar-bg: rgba(240,244,255,0.85);
      --scrollbar: #cbd5e1;
    }
    html.dark {
      --bg: #0a0f1e;
      --card-bg: #111827;
      --border: #1e293b;
      --text-primary: #f1f5f9;
      --text-secondary: #64748b;
      --shadow: rgba(0,0,0,0.3);
      --input-bg: #1e293b;
      --input-border: #334155;
      --badge-bg: #1e293b;
      --topbar-bg: rgba(10,15,30,0.85);
      --scrollbar: #334155;
    }
    /* ─── Reset ─────────────────────────────────────────────────── */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--bg);
      color: var(--text-primary);
      display: flex;
      height: 100vh;
      overflow: hidden;
      transition: background 0.3s, color 0.3s;
    }
    h1,h2,h3,h4 { font-family: 'Space Grotesk', sans-serif; }
    a { text-decoration: none; color: inherit; }
    button { font-family: inherit; }
    ::-webkit-scrollbar { width: 5px; height: 5px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--scrollbar); border-radius: 10px; }

    /* ─── Sidebar ────────────────────────────────────────────────── */
    .sidebar {
      width: 250px;
      background: var(--sidebar-bg);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
      transition: width 0.3s ease, transform 0.3s ease;
      z-index: 100;
      overflow: hidden;
    }
    .sidebar.collapsed { width: 68px; }
    .sidebar-logo {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 22px 18px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      min-height: 70px;
    }
    .sidebar-logo .logo-icon {
      width: 36px; height: 36px; flex-shrink: 0;
      background: linear-gradient(135deg, #3b82f6, #6366f1);
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      font-size: 16px; color: white; font-weight: 800;
      font-family: 'Space Grotesk', sans-serif;
    }
    .sidebar-logo .logo-text {
      font-family: 'Space Grotesk', sans-serif;
      font-weight: 800; font-size: 17px;
      color: #f1f5f9;
      white-space: nowrap;
      transition: opacity 0.2s;
    }
    .sidebar.collapsed .logo-text { opacity: 0; pointer-events: none; }
    .sidebar-toggle {
      position: absolute;
      top: 22px; left: 213px;
      background: #1e293b;
      border: 1px solid rgba(255,255,255,0.1);
      color: #94a3b8;
      width: 26px; height: 26px;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      font-size: 11px;
      transition: left 0.3s, background 0.2s;
      z-index: 101;
      flex-shrink: 0;
    }
    .sidebar-toggle:hover { background: #2d3f55; color: #f1f5f9; }
    .sidebar.collapsed ~ .sidebar-toggle,
    .sidebar.collapsed + * .sidebar-toggle { left: 51px; }
    .sidebar-nav { flex: 1; padding: 12px 0; overflow-y: auto; overflow-x: hidden; }
    .nav-section-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: rgba(148,163,184,0.4);
      padding: 14px 18px 6px;
      white-space: nowrap;
      transition: opacity 0.2s;
    }
    .sidebar.collapsed .nav-section-label { opacity: 0; height: 0; padding: 0; }
    .nav-item {
      display: flex;
      align-items: center;
      gap: 13px;
      padding: 11px 18px;
      cursor: pointer;
      border-radius: 0;
      transition: background 0.2s, color 0.2s;
      color: var(--sidebar-text);
      position: relative;
      white-space: nowrap;
      border-left: 3px solid transparent;
      margin: 1px 0;
    }
    .nav-item:hover { background: var(--sidebar-hover); color: #cbd5e1; }
    .nav-item.active {
      background: var(--sidebar-active-bg);
      color: #60a5fa;
      border-left-color: #3b82f6;
    }
    .nav-item i { width: 20px; text-align: center; font-size: 15px; flex-shrink: 0; }
    .nav-item span { font-size: 14px; font-weight: 500; transition: opacity 0.2s; }
    .sidebar.collapsed .nav-item span { opacity: 0; pointer-events: none; }
    .sidebar.collapsed .nav-item { padding: 12px; justify-content: center; }
    .sidebar.collapsed .nav-item i { margin: 0; }
    .nav-tooltip {
      display: none;
      position: absolute;
      left: 64px;
      background: #1e293b;
      color: #f1f5f9;
      padding: 5px 10px;
      border-radius: 6px;
      font-size: 13px;
      white-space: nowrap;
      z-index: 200;
      pointer-events: none;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .sidebar.collapsed .nav-item:hover .nav-tooltip { display: block; }
    .sidebar-bottom {
      padding: 14px 10px;
      border-top: 1px solid rgba(255,255,255,0.06);
    }
    .sidebar-bottom .nav-item { border-radius: 8px; border-left: none; }
    .sidebar-bottom .nav-item.logout { color: #f87171; }
    .sidebar-bottom .nav-item.logout:hover { background: rgba(239,68,68,0.1); }

    /* ─── Main Area ──────────────────────────────────────────────── */
    .main-wrapper {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
    }
    .topbar {
      height: 60px;
      background: var(--topbar-bg);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 28px;
      flex-shrink: 0;
      position: sticky;
      top: 0;
      z-index: 50;
    }
    .topbar-left h2 {
      font-size: 16px; font-weight: 700;
      color: var(--text-primary);
    }
    .topbar-left p { font-size: 12px; color: var(--text-secondary); margin-top: 1px; }
    .topbar-right { display: flex; align-items: center; gap: 10px; }
    .theme-toggle {
      width: 36px; height: 36px;
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 9px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; color: var(--text-secondary);
      font-size: 14px;
      transition: background 0.2s;
    }
    .theme-toggle:hover { background: var(--badge-bg); }
    .page-content {
      flex: 1;
      overflow-y: auto;
      padding: 28px;
    }

    /* ─── Page Sections ──────────────────────────────────────────── */
    .page-section { display: none; }
    .page-section.active { display: block; animation: fadeIn 0.25s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }

    /* ─── Cards ──────────────────────────────────────────────────── */
    .card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 22px;
      box-shadow: 0 2px 10px var(--shadow);
    }
    .card + .card, .card.mt { margin-top: 20px; }

    /* ─── Buttons ────────────────────────────────────────────────── */
    .btn {
      display: inline-flex; align-items: center; gap: 7px;
      padding: 9px 18px;
      border-radius: 9px;
      font-size: 13px; font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s;
    }
    .btn-primary { background: #3b82f6; color: white; }
    .btn-primary:hover { background: #2563eb; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(59,130,246,0.3); }
    .btn-secondary { background: var(--badge-bg); color: var(--text-primary); border: 1px solid var(--border); }
    .btn-secondary:hover { background: var(--border); }
    .btn-danger { background: #ef4444; color: white; }
    .btn-danger:hover { background: #dc2626; }
    .btn-success { background: #10b981; color: white; }
    .btn-success:hover { background: #059669; }
    .btn-sm { padding: 6px 12px; font-size: 12px; }

    /* ─── Badges ─────────────────────────────────────────────────── */
    .badge {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.3px;
    }
    .badge-primary  { background: rgba(59,130,246,0.12);  color: #2563eb; }
    .badge-success  { background: rgba(16,185,129,0.12);  color: #059669; }
    .badge-warning  { background: rgba(245,158,11,0.12);  color: #d97706; }
    .badge-error    { background: rgba(239,68,68,0.12);   color: #dc2626; }
    .badge-purple   { background: rgba(139,92,246,0.12);  color: #7c3aed; }
    .badge-neutral  { background: var(--badge-bg);        color: var(--text-secondary); }

    /* ─── Form elements ──────────────────────────────────────────── */
    input, select, textarea {
      width: 100%;
      padding: 10px 13px;
      border: 1px solid var(--input-border);
      border-radius: 9px;
      background: var(--input-bg);
      color: var(--text-primary);
      font-size: 14px;
      font-family: 'DM Sans', sans-serif;
      transition: border-color 0.2s;
      outline: none;
    }
    input:focus, select:focus, textarea:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.1); }
    label { display: block; font-size: 13px; font-weight: 600; color: var(--text-secondary); margin-bottom: 7px; }
    .form-group { margin-bottom: 18px; }

    /* ─── Page Headers ───────────────────────────────────────────── */
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      flex-wrap: wrap;
      gap: 14px;
      margin-bottom: 24px;
    }
    .page-header h1 { font-size: 24px; font-weight: 800; color: var(--text-primary); margin-bottom: 4px; }
    .page-header p { font-size: 14px; color: var(--text-secondary); }
    .page-actions { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }

    /* ─── Filters bar ────────────────────────────────────────────── */
    .filters { display: flex; gap: 10px; flex-wrap: wrap; }
    .filters select, .filters input { width: auto; min-width: 140px; padding: 9px 12px; }
    .filters input { flex: 1; }

    /* ─── Stat Cards ─────────────────────────────────────────────── */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 18px;
      margin-bottom: 24px;
    }
    .stat-card {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      color: white;
      padding: 22px;
      border-radius: 14px;
      box-shadow: 0 4px 16px rgba(59,130,246,0.25);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .stat-card:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(59,130,246,0.3); }
    .stat-card h3 { font-size: 12px; font-weight: 500; opacity: 0.85; margin-bottom: 10px; color: white; font-family: 'DM Sans', sans-serif; }
    .stat-card .stat-value { font-size: 34px; font-weight: 800; line-height: 1; margin-bottom: 4px; }
    .stat-card .stat-label { font-size: 12px; opacity: 0.75; }
    .stat-card.green  { background: linear-gradient(135deg, #10b981, #059669); box-shadow: 0 4px 16px rgba(16,185,129,0.25); }
    .stat-card.amber  { background: linear-gradient(135deg, #f59e0b, #d97706); box-shadow: 0 4px 16px rgba(245,158,11,0.25); }
    .stat-card.red    { background: linear-gradient(135deg, #ef4444, #dc2626); box-shadow: 0 4px 16px rgba(239,68,68,0.25); }
    .stat-card.purple { background: linear-gradient(135deg, #8b5cf6, #7c3aed); box-shadow: 0 4px 16px rgba(139,92,246,0.25); }

    /* ─── Mini stats ─────────────────────────────────────────────── */
    .mini-stats-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 14px;
      margin-bottom: 20px;
    }
    .mini-stat {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      display: flex;
      align-items: center;
      gap: 13px;
      box-shadow: 0 2px 8px var(--shadow);
    }
    .mini-stat-icon {
      width: 42px; height: 42px;
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      font-size: 16px; flex-shrink: 0;
    }
    .msi-blue   { background: rgba(59,130,246,0.12);  color: #3b82f6; }
    .msi-green  { background: rgba(16,185,129,0.12);  color: #10b981; }
    .msi-orange { background: rgba(245,158,11,0.12);  color: #f59e0b; }
    .msi-red    { background: rgba(239,68,68,0.12);   color: #ef4444; }
    .mini-stat-info h4 { font-size: 20px; font-weight: 800; color: var(--text-primary); margin-bottom: 1px; }
    .mini-stat-info p  { font-size: 11px; color: var(--text-secondary); }

    /* ─── Quick Actions ──────────────────────────────────────────── */
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 14px;
    }
    .qa-card {
      background: var(--card-bg);
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 18px;
      cursor: pointer;
      transition: all 0.25s;
      display: flex;
      align-items: center;
      gap: 14px;
    }
    .qa-card:hover { border-color: #3b82f6; background: rgba(59,130,246,0.04); transform: translateY(-2px); }
    .qa-card i { font-size: 22px; color: #3b82f6; }
    .qa-card h4 { font-size: 14px; font-weight: 700; color: var(--text-primary); margin-bottom: 3px; }
    .qa-card p  { font-size: 12px; color: var(--text-secondary); }

    /* ─── Tables ─────────────────────────────────────────────────── */
    .data-table { width: 100%; border-collapse: collapse; }
    .data-table th {
      background: var(--badge-bg);
      padding: 11px 14px;
      text-align: left;
      font-size: 12px;
      font-weight: 700;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-bottom: 2px solid var(--border);
    }
    .data-table td {
      padding: 12px 14px;
      border-bottom: 1px solid var(--border);
      font-size: 14px;
      color: var(--text-primary);
      vertical-align: middle;
    }
    .data-table tr:last-child td { border-bottom: none; }
    .data-table tr:hover td { background: rgba(59,130,246,0.03); }
    .q-text { max-width: 380px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

    /* ─── Pagination ─────────────────────────────────────────────── */
    .pagination {
      display: flex;
      justify-content: center;
      gap: 6px;
      margin-top: 18px;
      flex-wrap: wrap;
    }
    .pagination button {
      padding: 7px 11px;
      border: 1px solid var(--border);
      background: var(--card-bg);
      border-radius: 7px;
      cursor: pointer;
      font-size: 13px;
      color: var(--text-primary);
      transition: all 0.2s;
      width: auto;
    }
    .pagination button.active { background: #3b82f6; color: white; border-color: #3b82f6; }
    .pagination button:hover:not(.active):not(:disabled) { background: var(--badge-bg); }
    .pagination button:disabled { opacity: 0.4; cursor: not-allowed; }

    /* ─── Institutions grid ──────────────────────────────────────── */
    .inst-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
      gap: 18px;
    }
    .inst-card {
      background: var(--card-bg);
      border: 2px solid var(--border);
      border-radius: 14px;
      padding: 20px;
      box-shadow: 0 2px 8px var(--shadow);
      transition: border-color 0.25s, box-shadow 0.25s;
    }
    .inst-card:hover { border-color: #3b82f6; box-shadow: 0 6px 20px rgba(59,130,246,0.12); }
    .inst-card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 14px; }
    .inst-card-name { font-size: 17px; font-weight: 700; color: var(--text-primary); margin-bottom: 3px; }
    .inst-card-type { font-size: 12px; color: var(--text-secondary); }
    .detail-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 9px 0;
      border-bottom: 1px solid var(--border);
      font-size: 13px;
    }
    .detail-row:last-of-type { border-bottom: none; }
    .detail-label { font-weight: 600; color: var(--text-secondary); font-size: 12px; }
    .inst-actions { display: flex; gap: 8px; margin-top: 14px; }
    .inst-actions .btn { flex: 1; justify-content: center; }

    /* ─── Analytics ──────────────────────────────────────────────── */
    .analytics-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 18px;
      margin-bottom: 20px;
    }
    @media (max-width: 900px) { .analytics-grid { grid-template-columns: 1fr; } }
    .chart-card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 22px;
      box-shadow: 0 2px 8px var(--shadow);
    }
    .chart-card h4 {
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.6px;
      color: var(--text-secondary);
      margin-bottom: 18px;
    }
    .chart-card.full-width { grid-column: 1 / -1; }
    canvas { max-height: 260px; }
    .stat-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
      font-size: 14px;
    }
    .stat-row:last-child { border-bottom: none; }
    .stat-row-label { color: var(--text-secondary); font-size: 13px; }
    .stat-row-value { font-weight: 700; color: var(--text-primary); display: flex; align-items: center; gap: 6px; }
    .badge-pill { display: inline-block; padding: 2px 8px; border-radius: 20px; font-size: 11px; font-weight: 600; }
    .badge-pill.up      { background: rgba(16,185,129,0.12); color: #059669; }
    .badge-pill.down    { background: rgba(239,68,68,0.12);  color: #dc2626; }
    .badge-pill.neutral { background: var(--badge-bg);       color: var(--text-secondary); }
    .rank-num { display: inline-flex; width: 26px; height: 26px; align-items: center; justify-content: center; border-radius: 50%; font-size: 12px; font-weight: 700; color: white; background: #3b82f6; }
    .rank-num.gold   { background: #f59e0b; }
    .rank-num.silver { background: #94a3b8; }
    .rank-num.bronze { background: #b45309; }

    /* ─── Content Tabs ───────────────────────────────────────────── */
    .content-tabs {
      display: flex;
      gap: 6px;
      border-bottom: 2px solid var(--border);
      margin-bottom: 20px;
      overflow-x: auto;
    }
    .content-tab {
      padding: 10px 18px;
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      margin-bottom: -2px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      color: var(--text-secondary);
      white-space: nowrap;
      transition: color 0.2s;
    }
    .content-tab.active { color: #3b82f6; border-bottom-color: #3b82f6; }
    .content-panel { display: none; }
    .content-panel.active { display: block; }
    textarea { min-height: 380px; resize: vertical; }

    /* ─── Modal ──────────────────────────────────────────────────── */
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      backdrop-filter: blur(4px);
      z-index: 500;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .modal.active { display: flex; }
    .modal-box {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 28px;
      width: 100%;
      max-width: 580px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 25px 60px rgba(0,0,0,0.35);
      animation: slideUp 0.3s ease;
    }
    .modal-box.wide { max-width: 780px; }
    @keyframes slideUp { from { transform: translateY(16px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 22px;
    }
    .modal-header h2 { font-size: 20px; font-weight: 800; color: var(--text-primary); }
    .close-modal {
      background: var(--badge-bg);
      border: none;
      width: 32px; height: 32px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 18px;
      color: var(--text-secondary);
      display: flex; align-items: center; justify-content: center;
      transition: background 0.2s;
    }
    .close-modal:hover { background: var(--border); color: var(--text-primary); }
    .modal-detail-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 11px 0;
      border-bottom: 1px solid var(--border);
      font-size: 14px;
    }
    .modal-detail-row:last-child { border-bottom: none; }
    .modal-detail-label { font-weight: 600; color: var(--text-secondary); font-size: 13px; }

    /* ─── Upload drop zone ───────────────────────────────────────── */
    #dropZone {
      border: 2px dashed var(--border);
      border-radius: 12px;
      padding: 40px 20px;
      text-align: center;
      cursor: pointer;
      transition: border-color 0.2s, background 0.2s;
    }
    #dropZone:hover { border-color: #3b82f6; background: rgba(59,130,246,0.04); }
    #dropZone i { font-size: 36px; color: var(--text-secondary); display: block; margin-bottom: 12px; }
    #dropZone p { color: var(--text-secondary); font-size: 14px; }

    /* ─── Skeleton ───────────────────────────────────────────────── */
    .skeleton {
      background: linear-gradient(90deg, var(--border) 25%, var(--badge-bg) 50%, var(--border) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.4s infinite;
      border-radius: 8px;
    }
    @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    .sk-stat  { height: 100px; border-radius: 14px; }
    .sk-card  { height: 200px; border-radius: 14px; }
    .sk-chart { height: 240px; }
    .sk-row   { height: 20px; border-radius: 6px; margin-bottom: 14px; }
    .sk-mini  { height: 74px; border-radius: 12px; }

    /* ─── Spinner ────────────────────────────────────────────────── */
    .spinner {
      display: inline-block;
      width: 18px; height: 18px;
      border: 2px solid var(--border);
      border-top-color: #3b82f6;
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
      vertical-align: middle;
      margin-right: 6px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ─── Utilities ──────────────────────────────────────────────── */
    .flex { display: flex; }
    .items-center { align-items: center; }
    .gap-2 { gap: 10px; }
    .mt-3 { margin-top: 16px; }
    .mb-3 { margin-bottom: 16px; }
    .text-center { text-align: center; }
    .option-input { margin-bottom: 9px; }
    .state-box { text-align: center; padding: 50px 20px; color: var(--text-secondary); }
    .state-box i { font-size: 36px; opacity: 0.2; display: block; margin-bottom: 10px; }
    .error-banner {
      display: none;
      align-items: center;
      gap: 10px;
      background: rgba(239,68,68,0.08);
      border: 1px solid rgba(239,68,68,0.25);
      color: #ef4444;
      padding: 13px 16px;
      border-radius: 10px;
      margin-bottom: 18px;
      font-size: 14px;
    }
    .error-banner.show { display: flex; }
    .period-select {
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: 9px;
      background: var(--card-bg);
      color: var(--text-primary);
      font-size: 14px;
      cursor: pointer;
    }

    /* ─── Loading text ───────────────────────────────────────────── */
    .loading-text { text-align: center; padding: 30px; color: var(--text-secondary); }

    /* Mobile */
    @media (max-width: 640px) {
      .sidebar { position: fixed; transform: translateX(-100%); height: 100vh; }
      .sidebar.mobile-open { transform: translateX(0); width: 260px; }
      .page-content { padding: 16px; }
      .topbar { padding: 0 16px; }
      .analytics-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

  <!-- ═══ SIDEBAR ═══════════════════════════════════════════════════ -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-logo">
      <div class="logo-icon">AG</div>
      <span class="logo-text">AptioGen</span>
    </div>

    <nav class="sidebar-nav">
      <div class="nav-section-label">Main</div>

      <div class="nav-item active" data-page="dashboard">
        <i class="fa-solid fa-gauge-high"></i>
        <span>Dashboard</span>
        <div class="nav-tooltip">Dashboard</div>
      </div>

      <div class="nav-item" data-page="questions">
        <i class="fa-solid fa-circle-question"></i>
        <span>Question Bank</span>
        <div class="nav-tooltip">Question Bank</div>
      </div>

      <div class="nav-item" data-page="institutions">
        <i class="fa-solid fa-building-columns"></i>
        <span>Institutions</span>
        <div class="nav-tooltip">Institutions</div>
      </div>

      <div class="nav-section-label">Insights</div>

      <div class="nav-item" data-page="analytics">
        <i class="fa-solid fa-chart-line"></i>
        <span>Analytics</span>
        <div class="nav-tooltip">Analytics</div>
      </div>

      <div class="nav-section-label">Settings</div>

      <div class="nav-item" data-page="content">
        <i class="fa-solid fa-file-lines"></i>
        <span>Content</span>
        <div class="nav-tooltip">Content</div>
      </div>
    </nav>

    <div class="sidebar-bottom">
      <div class="nav-item logout" onclick="logout()">
        <i class="fa-solid fa-right-from-bracket"></i>
        <span>Logout</span>
        <div class="nav-tooltip">Logout</div>
      </div>
    </div>
  </aside>

  <!-- Sidebar toggle button -->
  <button class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()" title="Toggle sidebar">
    <i class="fa-solid fa-chevron-left" id="toggleIcon"></i>
  </button>

  <!-- ═══ MAIN ══════════════════════════════════════════════════════ -->
  <div class="main-wrapper">

    <!-- Topbar -->
    <header class="topbar">
      <div class="topbar-left">
        <h2 id="topbarTitle">Platform Dashboard</h2>
        <p id="topbarSub">Monitor and manage the entire AptioGen platform</p>
      </div>
      <div class="topbar-right">
        <div class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">
          <i class="fa-solid fa-moon" id="themeIcon"></i>
        </div>
      </div>
    </header>

    <!-- Page Content -->
    <main class="page-content">

      <!-- ══ DASHBOARD ══════════════════════════════════════════════ -->
      <section class="page-section active" id="pg-dashboard">
        <div class="page-header">
          <div><h1>Platform Overview</h1><p>Live metrics across the AptioGen platform</p></div>
        </div>

        <div class="stats-grid" id="dashStats">
          <div class="skeleton sk-stat"></div>
          <div class="skeleton sk-stat"></div>
          <div class="skeleton sk-stat"></div>
          <div class="skeleton sk-stat"></div>
          <div class="skeleton sk-stat"></div>
          <div class="skeleton sk-stat"></div>
        </div>

        <h2 style="font-size:18px;margin-bottom:14px;">Quick Actions</h2>
        <div class="quick-actions">
          <div class="qa-card" onclick="navigate('questions')">
            <i class="fa-solid fa-circle-question"></i>
            <div><h4>Question Bank</h4><p>Add & manage questions</p></div>
          </div>
          <div class="qa-card" onclick="navigate('institutions')">
            <i class="fa-solid fa-building-columns"></i>
            <div><h4>Institutions</h4><p>View & manage</p></div>
          </div>
          <div class="qa-card" onclick="navigate('analytics')">
            <i class="fa-solid fa-chart-line"></i>
            <div><h4>Analytics</h4><p>Platform insights</p></div>
          </div>
          <div class="qa-card" onclick="navigate('content')">
            <i class="fa-solid fa-file-lines"></i>
            <div><h4>Content</h4><p>T&C, Privacy, FAQs</p></div>
          </div>
        </div>
      </section>

      <!-- ══ QUESTIONS ══════════════════════════════════════════════ -->
      <section class="page-section" id="pg-questions">
        <div class="page-header">
          <div><h1>Question Bank</h1><p>Add, edit, and manage platform questions</p></div>
          <div class="page-actions">
            <button class="btn btn-secondary" onclick="openUploadModal()">
              <i class="fa-solid fa-file-upload"></i> Bulk Upload
            </button>
            <button class="btn btn-primary" onclick="openAddModal()">
              <i class="fa-solid fa-plus"></i> Add Question
            </button>
          </div>
        </div>

        <div class="card">
          <div class="filters">
            <select id="qCategoryFilter" onchange="loadQuestions()">
              <option value="">All Categories</option>
              <option value="aptitude">Aptitude</option>
              <option value="reasoning">Reasoning</option>
              <option value="coding">Coding</option>
              <option value="technical">Technical</option>
            </select>
            <select id="qLevelFilter" onchange="loadQuestions()">
              <option value="">All Levels</option>
              <option value="easy">Easy</option>
              <option value="medium">Medium</option>
              <option value="hard">Hard</option>
            </select>
            <input type="text" id="qSearch" placeholder="Search questions..." onkeyup="handleQSearch()">
          </div>
        </div>

        <div class="card mt">
          <div id="qLoading" class="loading-text">Loading questions…</div>
          <div style="overflow-x:auto;">
            <table class="data-table" id="questionsTable" style="display:none;">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Question</th>
                  <th>Category</th>
                  <th>Level</th>
                  <th>Topic</th>
                  <th>Usage</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="questionsBody"></tbody>
            </table>
          </div>
          <div class="pagination" id="qPagination"></div>
        </div>
      </section>

      <!-- ══ INSTITUTIONS ══════════════════════════════════════════ -->
      <section class="page-section" id="pg-institutions">
        <div class="page-header">
          <div><h1>Institution Management</h1><p>View and manage all registered institutions</p></div>
        </div>

        <div class="mini-stats-row" id="instStats">
          <div class="skeleton sk-mini"></div>
          <div class="skeleton sk-mini"></div>
          <div class="skeleton sk-mini"></div>
          <div class="skeleton sk-mini"></div>
        </div>

        <div class="card">
          <div class="filters">
            <select id="instStatusFilter" onchange="loadInstitutions()">
              <option value="">All Status</option>
              <option value="active">Active</option>
              <option value="suspended">Suspended</option>
              <option value="expired">Expired</option>
            </select>
            <select id="instPlanFilter" onchange="loadInstitutions()">
              <option value="">All Plans</option>
              <option value="free">Free</option>
              <option value="basic">Basic</option>
              <option value="premium">Premium</option>
              <option value="enterprise">Enterprise</option>
            </select>
            <input type="text" id="instSearch" placeholder="Search institutions…" oninput="handleInstSearch()">
          </div>
        </div>

        <div id="instContent" class="mt-3"></div>
      </section>

      <!-- ══ ANALYTICS ═════════════════════════════════════════════ -->
      <section class="page-section" id="pg-analytics">
        <div class="page-header">
          <div><h1>Platform Analytics</h1><p>Growth trends and insights</p></div>
          <div class="page-actions">
            <label style="font-size:13px;color:var(--text-secondary);margin-bottom:0;">Period:</label>
            <select class="period-select" id="periodFilter" onchange="loadAnalytics()">
              <option value="7">Last 7 days</option>
              <option value="30" selected>Last 30 days</option>
              <option value="90">Last 90 days</option>
              <option value="365">This year</option>
            </select>
          </div>
        </div>

        <div class="error-banner" id="analyticsBanner">
          <i class="fa-solid fa-triangle-exclamation"></i>
          <span id="analyticsErr">Could not load analytics.</span>
        </div>

        <div class="stats-grid" id="analyticsKPIs">
          <div class="skeleton sk-stat"></div>
          <div class="skeleton sk-stat"></div>
          <div class="skeleton sk-stat"></div>
          <div class="skeleton sk-stat"></div>
        </div>

        <div class="analytics-grid">
          <div class="chart-card">
            <h4><i class="fa fa-building-columns" style="color:#3b82f6;margin-right:6px;"></i>Institution Growth</h4>
            <div class="skeleton sk-chart" id="skInst"></div>
            <canvas id="instChart" style="display:none;"></canvas>
          </div>
          <div class="chart-card">
            <h4><i class="fa fa-users" style="color:#10b981;margin-right:6px;"></i>Student Growth</h4>
            <div class="skeleton sk-chart" id="skStu"></div>
            <canvas id="stuChart" style="display:none;"></canvas>
          </div>
          <div class="chart-card">
            <h4><i class="fa fa-tags" style="color:#8b5cf6;margin-right:6px;"></i>Questions by Category</h4>
            <div class="skeleton sk-chart" id="skCat"></div>
            <canvas id="catChart" style="display:none;"></canvas>
          </div>
          <div class="chart-card">
            <h4><i class="fa fa-signal" style="color:#f59e0b;margin-right:6px;"></i>Questions by Difficulty</h4>
            <div class="skeleton sk-chart" id="skDiff"></div>
            <canvas id="diffChart" style="display:none;"></canvas>
          </div>
          <div class="chart-card">
            <h4><i class="fa fa-heart-pulse" style="color:#ef4444;margin-right:6px;"></i>Platform Health</h4>
            <div id="healthRows">
              <div class="skeleton sk-row"></div><div class="skeleton sk-row"></div>
              <div class="skeleton sk-row"></div><div class="skeleton sk-row"></div>
              <div class="skeleton sk-row" style="margin-bottom:0;"></div>
            </div>
          </div>
          <div class="chart-card full-width">
            <h4><i class="fa fa-ranking-star" style="color:#f59e0b;margin-right:6px;"></i>Top Institutions</h4>
            <div id="topInstTable"><div class="skeleton" style="height:180px;border-radius:8px;"></div></div>
          </div>
        </div>
      </section>

      <!-- ══ CONTENT ════════════════════════════════════════════════ -->
      <section class="page-section" id="pg-content">
        <div class="page-header">
          <div><h1>Content Management</h1><p>Manage Terms & Conditions, Privacy Policy, and FAQs</p></div>
        </div>

        <div class="card">
          <div class="content-tabs">
            <button class="content-tab active" data-panel="cStudentTerms">Student T&C</button>
            <button class="content-tab" data-panel="cInstTerms">Institute T&C</button>
            <button class="content-tab" data-panel="cPrivacy">Privacy Policy</button>
            <button class="content-tab" data-panel="cFaqs">FAQs</button>
          </div>

          <div id="cStudentTerms" class="content-panel active">
            <div class="flex items-center gap-2 mb-3" style="justify-content:space-between;">
              <h3 style="font-size:16px;">Student Terms & Conditions</h3>
              <span class="badge badge-neutral">Key: studentTerms</span>
            </div>
            <textarea id="studentTermsContent" placeholder="Enter student terms and conditions…"></textarea>
            <button class="btn btn-primary mt-3" onclick="saveContent('studentTerms')">
              <i class="fa-solid fa-floppy-disk"></i> Save Student Terms
            </button>
          </div>

          <div id="cInstTerms" class="content-panel">
            <div class="flex items-center gap-2 mb-3" style="justify-content:space-between;">
              <h3 style="font-size:16px;">Institute Terms & Conditions</h3>
              <span class="badge badge-neutral">Key: instituteTerms</span>
            </div>
            <textarea id="instituteTermsContent" placeholder="Enter institute terms and conditions…"></textarea>
            <button class="btn btn-primary mt-3" onclick="saveContent('instituteTerms')">
              <i class="fa-solid fa-floppy-disk"></i> Save Institute Terms
            </button>
          </div>

          <div id="cPrivacy" class="content-panel">
            <h3 style="font-size:16px;margin-bottom:14px;">Privacy Policy</h3>
            <textarea id="privacyContent" placeholder="Enter privacy policy…"># Privacy Policy

Last updated: February 15, 2026

## Information We Collect
- Account information (name, email, institution)
- Performance data (quiz scores, progress)
- Usage analytics

## How We Use Information
- Provide educational services
- Track student progress
- Improve platform features
- Generate analytics for institutions

## Data Sharing
We do not sell personal data. Information is shared only with:
- Your institution (for enrolled students)
- Service providers (hosting, analytics)

## Data Security
We implement industry-standard security measures to protect your data.

## Your Rights
- Access your data
- Request data deletion
- Opt-out of analytics

## Contact
privacy@aptiogen.com</textarea>
            <button class="btn btn-primary mt-3" onclick="saveContent('privacy')">
              <i class="fa-solid fa-floppy-disk"></i> Save Privacy Policy
            </button>
          </div>

          <div id="cFaqs" class="content-panel">
            <h3 style="font-size:16px;margin-bottom:14px;">Frequently Asked Questions</h3>
            <textarea id="faqsContent" placeholder="Enter FAQs…"># Frequently Asked Questions

## For Students

**Q: How do I join my institution?**
A: Use the credentials provided by your institution admin during registration.

**Q: Can I practice without joining an institution?**
A: Yes! Select "Independent Student" during login to access public practice quizzes.

**Q: How is my rank calculated?**
A: Rankings are based on your average score across all completed events.

## For Institutions

**Q: How do I add students?**
A: Use the batch management system to create batches and add students via CSV import or manual entry.

**Q: Can I create custom questions?**
A: Currently, questions are managed by the platform admin. You can select from the question bank when creating events.

**Q: What subscription plans are available?**
A: Free, Basic, Premium, and Enterprise plans with varying student limits and features.

## Technical

**Q: Which browsers are supported?**
A: Chrome, Firefox, Safari, and Edge (latest versions).

**Q: Is there a mobile app?**
A: Currently web-only, but the platform is mobile-responsive.

**Q: How do I report a bug?**
A: Contact support@aptiogen.com with details.</textarea>
            <button class="btn btn-primary mt-3" onclick="saveContent('faqs')">
              <i class="fa-solid fa-floppy-disk"></i> Save FAQs
            </button>
          </div>
        </div>
      </section>

    </main>
  </div>

  <!-- ═══ MODALS ════════════════════════════════════════════════════ -->

  <!-- Add/Edit Question Modal -->
  <div class="modal" id="questionModal">
    <div class="modal-box">
      <div class="modal-header">
        <h2 id="qModalTitle">Add Question</h2>
        <button class="close-modal" onclick="closeModal('questionModal')">×</button>
      </div>
      <form id="questionForm">
        <input type="hidden" id="questionId">
        <div class="form-group">
          <label>Category *</label>
          <select id="qCategory" required>
            <option value="">Select Category</option>
            <option value="aptitude">Aptitude</option>
            <option value="reasoning">Reasoning</option>
            <option value="coding">Coding</option>
            <option value="technical">Technical</option>
          </select>
        </div>
        <div class="form-group">
          <label>Topic *</label>
          <input type="text" id="qTopic" placeholder="e.g., Number Systems" required>
        </div>
        <div class="form-group">
          <label>Difficulty Level *</label>
          <select id="qLevel" required>
            <option value="">Select Level</option>
            <option value="easy">Easy</option>
            <option value="medium">Medium</option>
            <option value="hard">Hard</option>
          </select>
        </div>
        <div class="form-group">
          <label>Question *</label>
          <textarea id="qText" rows="3" placeholder="Enter the question" required style="min-height:90px;"></textarea>
        </div>
        <div class="form-group">
          <label>Options *</label>
          <input type="text" class="option-input" id="opt1" placeholder="Option 1" required>
          <input type="text" class="option-input" id="opt2" placeholder="Option 2" required>
          <input type="text" class="option-input" id="opt3" placeholder="Option 3">
          <input type="text" class="option-input" id="opt4" placeholder="Option 4">
        </div>
        <div class="form-group">
          <label>Correct Answer *</label>
          <input type="text" id="qCorrect" placeholder="Enter the correct answer exactly" required>
        </div>
        <div class="form-group">
          <label>Explanation (Optional)</label>
          <textarea id="qExplanation" rows="2" placeholder="Explain the answer" style="min-height:70px;"></textarea>
        </div>
        <div class="form-group">
          <label>Tags (comma-separated)</label>
          <input type="text" id="qTags" placeholder="e.g., math, basic, algebra">
        </div>
        <div class="flex gap-2">
          <button type="submit" class="btn btn-primary"><i class="fa-solid fa-floppy-disk"></i> Save Question</button>
          <button type="button" class="btn btn-secondary" onclick="closeModal('questionModal')">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Bulk Upload Modal -->
  <div class="modal" id="uploadModal">
    <div class="modal-box wide">
      <div class="modal-header">
        <h2>Bulk Upload Questions</h2>
        <button class="close-modal" onclick="closeModal('uploadModal')">×</button>
      </div>
      <p style="color:var(--text-secondary);font-size:14px;margin-bottom:18px;">
        Upload a PDF or DOCX file. The system will attempt to extract questions and options automatically.
      </p>
      <div id="dropZone" onclick="document.getElementById('fileInput').click()">
        <i class="fa-solid fa-cloud-arrow-up"></i>
        <p id="dropText">Click to select or drag and drop your file</p>
        <p style="font-size:12px;margin-top:6px;">Supported: .pdf, .docx (Max 10MB)</p>
        <input type="file" id="fileInput" accept=".pdf,.docx" style="display:none;">
      </div>
      <div id="uploadStatus" style="display:none;text-align:center;padding:14px;">
        <span class="spinner"></span> Processing file… Please wait.
      </div>
      <div class="flex gap-2 mt-3" style="justify-content:flex-end;">
        <button class="btn btn-secondary" onclick="closeModal('uploadModal')">Cancel</button>
        <button class="btn btn-primary" id="btnProcess" disabled onclick="processUpload()">
          <i class="fa-solid fa-gears"></i> Process File
        </button>
      </div>
      <div id="reviewSection" style="display:none;" class="mt-3">
        <hr style="border:none;border-top:1px solid var(--border);margin-bottom:18px;">
        <h3 style="margin-bottom:12px;">Review Extracted Questions (<span id="extractedCount">0</span>)</h3>
        <div id="extractedList" style="max-height:320px;overflow-y:auto;padding:8px;background:var(--badge-bg);border-radius:10px;"></div>
        <button class="btn btn-success mt-3" style="width:100%;" onclick="confirmBulkImport()">
          <i class="fa-solid fa-check-double"></i> Confirm & Import All
        </button>
      </div>
    </div>
  </div>

  <!-- Institution Details Modal -->
  <div class="modal" id="instModal">
    <div class="modal-box">
      <div class="modal-header">
        <h2><i class="fa fa-building-columns" style="color:#3b82f6;margin-right:8px;"></i>Institution Details</h2>
        <button class="close-modal" onclick="closeModal('instModal')">×</button>
      </div>
      <div id="instModalBody"></div>
    </div>
  </div>

  <!-- ═══ JAVASCRIPT ════════════════════════════════════════════════ -->
  <script>
    /* ── Config ───────────────────────────────────────────────────── */
    const API_BASE   = 'http://localhost:5000/api';
    const authToken  = sessionStorage.getItem('superAdminAuth') || '';

    /* ── Auth guard ───────────────────────────────────────────────── */
    if (!authToken) {
      // Commented out for standalone demo; uncomment in production:
      // window.location.href = 'super-admin-login.html';
    }

    /* ── Theme ────────────────────────────────────────────────────── */
    const savedTheme = localStorage.getItem('theme') || 'light';
    if (savedTheme === 'dark') applyDark();

    function applyDark() {
      document.documentElement.classList.add('dark');
      document.getElementById('themeIcon').className = 'fa-solid fa-sun';
    }
    function applyLight() {
      document.documentElement.classList.remove('dark');
      document.getElementById('themeIcon').className = 'fa-solid fa-moon';
    }
    function toggleTheme() {
      const isDark = document.documentElement.classList.contains('dark');
      isDark ? applyLight() : applyDark();
      localStorage.setItem('theme', isDark ? 'light' : 'dark');
    }

    /* ── Sidebar ──────────────────────────────────────────────────── */
    let sidebarCollapsed = false;
    function toggleSidebar() {
      sidebarCollapsed = !sidebarCollapsed;
      document.getElementById('sidebar').classList.toggle('collapsed', sidebarCollapsed);
      document.getElementById('toggleIcon').className = sidebarCollapsed ? 'fa-solid fa-chevron-right' : 'fa-solid fa-chevron-left';
      // Reposition toggle button
      document.getElementById('sidebarToggle').style.left = sidebarCollapsed ? '51px' : '213px';
    }

    /* ── Navigation ───────────────────────────────────────────────── */
    const pageInfo = {
      dashboard:    { title: 'Platform Dashboard',       sub: 'Monitor and manage the entire AptioGen platform' },
      questions:    { title: 'Question Bank',             sub: 'Add, edit, and manage platform questions' },
      institutions: { title: 'Institution Management',   sub: 'View and manage all registered institutions' },
      analytics:    { title: 'Platform Analytics',       sub: 'Growth trends and insights across the platform' },
      content:      { title: 'Content Management',       sub: 'Manage Terms & Conditions, Privacy Policy, and FAQs' },
    };
    const pageLoaded = {};

    function navigate(pageId) {
      // Update nav items
      document.querySelectorAll('.nav-item').forEach(el => {
        el.classList.toggle('active', el.dataset.page === pageId);
      });
      // Update sections
      document.querySelectorAll('.page-section').forEach(s => {
        s.classList.toggle('active', s.id === 'pg-' + pageId);
      });
      // Update topbar
      document.getElementById('topbarTitle').textContent = pageInfo[pageId]?.title || '';
      document.getElementById('topbarSub').textContent   = pageInfo[pageId]?.sub   || '';
      // Lazy load data once
      if (!pageLoaded[pageId]) {
        pageLoaded[pageId] = true;
        if (pageId === 'dashboard')    loadDashboard();
        if (pageId === 'questions')    loadQuestions();
        if (pageId === 'institutions') loadInstitutions();
        if (pageId === 'analytics')    loadAnalytics();
        if (pageId === 'content')      loadAllContent();
      }
    }

    // Attach nav item listeners
    document.querySelectorAll('.nav-item[data-page]').forEach(el => {
      el.addEventListener('click', () => navigate(el.dataset.page));
    });

    /* ── Logout ───────────────────────────────────────────────────── */
    function logout() {
      if (!confirm('Are you sure you want to logout?')) return;
      sessionStorage.removeItem('superAdminAuth');
      window.location.href = 'super-admin-login.html';
    }

    /* ── Modal Helpers ────────────────────────────────────────────── */
    function openModal(id)  { document.getElementById(id).classList.add('active'); }
    function closeModal(id) { document.getElementById(id).classList.remove('active'); }

    // Close on backdrop click
    document.querySelectorAll('.modal').forEach(m => {
      m.addEventListener('click', e => { if (e.target === m) m.classList.remove('active'); });
    });

    /* ════════════════════════════════════════════════════════════════
       DASHBOARD
    ════════════════════════════════════════════════════════════════ */
    async function loadDashboard() {
      try {
        const r    = await fetch(`${API_BASE}/super-admin/dashboard`, { headers: authHeaders() });
        const data = await r.json();
        if (!r.ok) throw new Error(data.error || 'Failed');
        const ov   = data.overview;
        document.getElementById('dashStats').innerHTML = `
          <div class="stat-card">
            <h3><i class="fa fa-building-columns"></i> Total Institutions</h3>
            <div class="stat-value">${ov.totalInstitutions ?? '—'}</div>
            <div class="stat-label">Registered institutions</div>
          </div>
          <div class="stat-card green">
            <h3><i class="fa fa-circle-check"></i> Active Institutions</h3>
            <div class="stat-value">${ov.activeInstitutions ?? '—'}</div>
            <div class="stat-label">Currently active</div>
          </div>
          <div class="stat-card amber">
            <h3><i class="fa fa-users"></i> Total Students</h3>
            <div class="stat-value">${(ov.totalStudents ?? 0).toLocaleString()}</div>
            <div class="stat-label">Platform-wide</div>
          </div>
          <div class="stat-card purple">
            <h3><i class="fa fa-circle-question"></i> Question Bank</h3>
            <div class="stat-value">${(ov.totalQuestions ?? 0).toLocaleString()}</div>
            <div class="stat-label">Total questions</div>
          </div>
          <div class="stat-card green">
            <h3><i class="fa fa-calendar-check"></i> Total Events</h3>
            <div class="stat-value">${ov.totalEvents ?? '—'}</div>
            <div class="stat-label">All-time events</div>
          </div>
          <div class="stat-card red">
            <h3><i class="fa fa-ban"></i> Suspended</h3>
            <div class="stat-value">${ov.suspendedInstitutions ?? '—'}</div>
            <div class="stat-label">Suspended institutions</div>
          </div>
        `;
      } catch (e) {
        document.getElementById('dashStats').innerHTML = `<p style="color:#ef4444;padding:20px;">Failed to load: ${e.message}</p>`;
      }
    }

    /* ════════════════════════════════════════════════════════════════
       QUESTIONS
    ════════════════════════════════════════════════════════════════ */
    let qPage = 1, qSearchTimeout, extractedQuestions = [];

    async function loadQuestions(page = 1) {
      qPage = page;
      const category = document.getElementById('qCategoryFilter').value;
      const level    = document.getElementById('qLevelFilter').value;
      const search   = document.getElementById('qSearch').value;
      const params   = new URLSearchParams({ page, limit: 10, ...(category && { category }), ...(level && { level }), ...(search && { search }) });

      document.getElementById('qLoading').style.display = 'block';
      document.getElementById('questionsTable').style.display = 'none';

      try {
        const r    = await fetch(`${API_BASE}/super-admin/questions?${params}`, { headers: authHeaders() });
        const data = await r.json();
        if (!r.ok) throw new Error(data.error);
        renderQuestions(data.questions);
        renderQPagination(data.pagination);
        document.getElementById('qLoading').style.display = 'none';
        document.getElementById('questionsTable').style.display = 'table';
      } catch(e) {
        document.getElementById('qLoading').textContent = 'Failed to load questions: ' + e.message;
      }
    }

    function renderQuestions(questions) {
      document.getElementById('questionsBody').innerHTML = questions.map(q => `
        <tr>
          <td style="font-size:12px;color:var(--text-secondary);">${q.questionID || '—'}</td>
          <td class="q-text" title="${q.question}">${q.question}</td>
          <td><span class="badge badge-primary">${q.category}</span></td>
          <td><span class="badge ${q.level==='easy'?'badge-success':q.level==='medium'?'badge-warning':'badge-error'}">${q.level}</span></td>
          <td style="font-size:13px;">${q.topic}</td>
          <td>${q.usageCount || 0}</td>
          <td>
            <button class="btn btn-secondary btn-sm" onclick="editQuestion('${q._id}')"><i class="fa-solid fa-edit"></i></button>
            <button class="btn btn-danger btn-sm" onclick="deleteQuestion('${q._id}')"><i class="fa-solid fa-trash"></i></button>
          </td>
        </tr>
      `).join('');
    }

    function renderQPagination(p) {
      let html = `<button ${p.page===1?'disabled':''} onclick="loadQuestions(${p.page-1})"><i class="fa-solid fa-chevron-left"></i></button>`;
      for (let i = 1; i <= p.pages; i++) html += `<button class="${i===p.page?'active':''}" onclick="loadQuestions(${i})">${i}</button>`;
      html += `<button ${p.page===p.pages?'disabled':''} onclick="loadQuestions(${p.page+1})"><i class="fa-solid fa-chevron-right"></i></button>`;
      document.getElementById('qPagination').innerHTML = html;
    }

    function handleQSearch() {
      clearTimeout(qSearchTimeout);
      qSearchTimeout = setTimeout(() => loadQuestions(), 500);
    }

    function openAddModal() {
      document.getElementById('qModalTitle').textContent = 'Add Question';
      document.getElementById('questionForm').reset();
      document.getElementById('questionId').value = '';
      openModal('questionModal');
    }

    async function editQuestion(id) {
      try {
        const r    = await fetch(`${API_BASE}/super-admin/questions?search=${id}`, { headers: authHeaders() });
        const data = await r.json();
        if (r.ok && data.questions.length) {
          const q = data.questions[0];
          document.getElementById('qModalTitle').textContent = 'Edit Question';
          document.getElementById('questionId').value   = q._id;
          document.getElementById('qCategory').value    = q.category;
          document.getElementById('qTopic').value       = q.topic;
          document.getElementById('qLevel').value       = q.level;
          document.getElementById('qText').value        = q.question;
          document.getElementById('opt1').value         = q.options[0] || '';
          document.getElementById('opt2').value         = q.options[1] || '';
          document.getElementById('opt3').value         = q.options[2] || '';
          document.getElementById('opt4').value         = q.options[3] || '';
          document.getElementById('qCorrect').value     = q.correctAnswer;
          document.getElementById('qExplanation').value = q.explanation || '';
          document.getElementById('qTags').value        = q.tags ? q.tags.join(', ') : '';
          openModal('questionModal');
        }
      } catch(e) { alert('Failed to load question: ' + e.message); }
    }

    async function deleteQuestion(id) {
      if (!confirm('Delete this question?')) return;
      try {
        const r = await fetch(`${API_BASE}/super-admin/questions/${id}`, { method: 'DELETE', headers: authHeaders() });
        r.ok ? (alert('Deleted.'), loadQuestions(qPage)) : alert('Failed to delete.');
      } catch(e) { alert('Error: ' + e.message); }
    }

    document.getElementById('questionForm').addEventListener('submit', async e => {
      e.preventDefault();
      const options = [
        document.getElementById('opt1').value,
        document.getElementById('opt2').value,
        document.getElementById('opt3').value,
        document.getElementById('opt4').value,
      ].filter(o => o.trim());

      const payload = {
        category:      document.getElementById('qCategory').value,
        topic:         document.getElementById('qTopic').value,
        level:         document.getElementById('qLevel').value,
        question:      document.getElementById('qText').value,
        options,
        correctAnswer: document.getElementById('qCorrect').value,
        explanation:   document.getElementById('qExplanation').value,
        tags:          document.getElementById('qTags').value.split(',').map(t => t.trim()).filter(Boolean),
        createdBy:     'super-admin',
      };

      const qId   = document.getElementById('questionId').value;
      const url   = qId ? `${API_BASE}/super-admin/questions/${qId}` : `${API_BASE}/super-admin/questions`;
      const method = qId ? 'PUT' : 'POST';

      try {
        const r = await fetch(url, { method, headers: { ...authHeaders(), 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
        if (r.ok) {
          alert(qId ? 'Question updated.' : 'Question added.');
          closeModal('questionModal');
          loadQuestions(qPage);
        } else {
          const d = await r.json();
          alert('Error: ' + (d.error || 'Save failed'));
        }
      } catch(e) { alert('Error: ' + e.message); }
    });

    // Bulk upload
    function openUploadModal() {
      document.getElementById('uploadModal').classList.add('active');
      document.getElementById('reviewSection').style.display = 'none';
      document.getElementById('uploadStatus').style.display  = 'none';
      document.getElementById('btnProcess').disabled = true;
      document.getElementById('fileInput').value = '';
      document.getElementById('dropText').textContent = 'Click to select or drag and drop your file';
      extractedQuestions = [];
    }

    document.getElementById('fileInput').addEventListener('change', () => {
      const f = document.getElementById('fileInput').files[0];
      if (f) {
        document.getElementById('dropText').textContent = f.name;
        document.getElementById('btnProcess').disabled = false;
      }
    });

    async function processUpload() {
      const file = document.getElementById('fileInput').files[0];
      if (!file) return;
      const formData = new FormData();
      formData.append('file', file);
      document.getElementById('uploadStatus').style.display = 'block';
      document.getElementById('btnProcess').disabled = true;
      try {
        const r    = await fetch(`${API_BASE}/super-admin/questions/upload`, { method: 'POST', headers: { 'Authorization': `Bearer ${authToken}` }, body: formData });
        const data = await r.json();
        if (r.ok && data.success) {
          extractedQuestions = data.questions;
          document.getElementById('extractedCount').textContent = data.count;
          document.getElementById('extractedList').innerHTML = extractedQuestions.map((q, i) => `
            <div style="background:var(--card-bg);border-radius:8px;padding:12px;margin-bottom:8px;font-size:13px;">
              <strong>Q${i+1}:</strong> ${q.question}
              <div style="color:var(--text-secondary);margin-top:4px;">Options: ${q.options.join(', ')}</div>
              <div style="color:#059669;margin-top:4px;">Answer: ${q.correctAnswer}</div>
            </div>
          `).join('');
          document.getElementById('reviewSection').style.display = 'block';
          document.getElementById('uploadStatus').style.display  = 'none';
        } else {
          throw new Error(data.error || 'Processing failed');
        }
      } catch(e) {
        alert('Upload failed: ' + e.message);
        document.getElementById('uploadStatus').style.display = 'none';
        document.getElementById('btnProcess').disabled = false;
      }
    }

    async function confirmBulkImport() {
      if (!confirm(`Import ${extractedQuestions.length} questions?`)) return;
      try {
        const r = await fetch(`${API_BASE}/super-admin/questions/bulk`, {
          method: 'POST',
          headers: { ...authHeaders(), 'Content-Type': 'application/json' },
          body: JSON.stringify({ questions: extractedQuestions })
        });
        if (r.ok) { alert('Imported successfully!'); closeModal('uploadModal'); loadQuestions(); }
        else       alert('Import failed.');
      } catch(e) { alert('Error: ' + e.message); }
    }

    /* ════════════════════════════════════════════════════════════════
       INSTITUTIONS
    ════════════════════════════════════════════════════════════════ */
    let instSearchTimeout;

    async function loadInstitutions() {
      const status = document.getElementById('instStatusFilter').value;
      const plan   = document.getElementById('instPlanFilter').value;
      const search = document.getElementById('instSearch').value;
      const params = new URLSearchParams({ page:1, limit:50, ...(status&&{status}), ...(plan&&{plan}), ...(search&&{search}) });

      try {
        const r    = await fetch(`${API_BASE}/super-admin/institutions?${params}`, { headers: authHeaders() });
        if (!r.ok) throw new Error(`Server error ${r.status}`);
        const data = await r.json();
        const list = data.institutions ?? [];
        renderInstStats(list);
        renderInstCards(list);
      } catch(e) {
        document.getElementById('instContent').innerHTML = `<div class="state-box"><i class="fa fa-triangle-exclamation" style="opacity:1;color:#ef4444;"></i><p style="color:#ef4444;">Failed: ${e.message}</p></div>`;
        document.getElementById('instStats').innerHTML = '<p style="color:#ef4444;font-size:13px;">Could not load stats.</p>';
      }
    }

    function renderInstStats(list) {
      const total     = list.length;
      const active    = list.filter(i => i.subscription?.status === 'active').length;
      const suspended = list.filter(i => i.subscription?.status === 'suspended').length;
      const expired   = list.filter(i => i.subscription?.status === 'expired').length;
      document.getElementById('instStats').innerHTML = `
        <div class="mini-stat"><div class="mini-stat-icon msi-blue"><i class="fa fa-building-columns"></i></div><div class="mini-stat-info"><h4>${total}</h4><p>Total</p></div></div>
        <div class="mini-stat"><div class="mini-stat-icon msi-green"><i class="fa fa-circle-check"></i></div><div class="mini-stat-info"><h4>${active}</h4><p>Active</p></div></div>
        <div class="mini-stat"><div class="mini-stat-icon msi-red"><i class="fa fa-ban"></i></div><div class="mini-stat-info"><h4>${suspended}</h4><p>Suspended</p></div></div>
        <div class="mini-stat"><div class="mini-stat-icon msi-orange"><i class="fa fa-clock"></i></div><div class="mini-stat-info"><h4>${expired}</h4><p>Expired</p></div></div>
      `;
    }

    function renderInstCards(list) {
      const el = document.getElementById('instContent');
      if (!list.length) { el.innerHTML = `<div class="state-box"><i class="fa fa-building-columns"></i><p>No institutions found.</p></div>`; return; }
      el.innerHTML = `<div class="inst-grid">${list.map(inst => {
        const status     = inst.subscription?.status ?? 'unknown';
        const badgeClass = status==='active'?'badge-success':status==='suspended'?'badge-error':'badge-warning';
        return `<div class="inst-card">
          <div class="inst-card-header">
            <div>
              <div class="inst-card-name">${inst.name}</div>
              <div class="inst-card-type">${inst.type ?? 'Institution'}</div>
            </div>
            <span class="badge ${badgeClass}">${status}</span>
          </div>
          <div class="detail-row"><span class="detail-label">Plan</span><span class="badge badge-primary">${inst.subscription?.plan ?? '—'}</span></div>
          <div class="detail-row"><span class="detail-label">Location</span><span>${inst.location?.district ?? '—'}, ${inst.location?.state ?? '—'}</span></div>
          <div class="detail-row"><span class="detail-label">Email</span><span style="word-break:break-all;font-size:13px;">${inst.email ?? '—'}</span></div>
          <div class="inst-actions">
            <button class="btn btn-primary btn-sm" onclick="viewInstDetails('${inst._id}')"><i class="fa-solid fa-eye"></i> View</button>
            ${status==='active'
              ? `<button class="btn btn-danger btn-sm" onclick="suspendInst('${inst._id}')"><i class="fa-solid fa-ban"></i> Suspend</button>`
              : `<button class="btn btn-success btn-sm" onclick="activateInst('${inst._id}')"><i class="fa-solid fa-check"></i> Activate</button>`
            }
          </div>
        </div>`;
      }).join('')}</div>`;
    }

    function handleInstSearch() {
      clearTimeout(instSearchTimeout);
      instSearchTimeout = setTimeout(() => loadInstitutions(), 500);
    }

    async function viewInstDetails(id) {
      document.getElementById('instModalBody').innerHTML = '<div style="text-align:center;padding:30px;"><span class="spinner"></span> Loading…</div>';
      openModal('instModal');
      try {
        const r    = await fetch(`${API_BASE}/super-admin/institutions/${id}`, { headers: authHeaders() });
        if (!r.ok) throw new Error(`Server error ${r.status}`);
        const data = await r.json();
        const inst = data.institution, stats = data.stats;
        document.getElementById('instModalBody').innerHTML = `
          <div class="modal-detail-row"><span class="modal-detail-label">Name</span><span>${inst.name}</span></div>
          <div class="modal-detail-row"><span class="modal-detail-label">Type</span><span>${inst.type}</span></div>
          <div class="modal-detail-row"><span class="modal-detail-label">Email</span><span>${inst.email}</span></div>
          <div class="modal-detail-row"><span class="modal-detail-label">Phone</span><span>${inst.phone ?? '—'}</span></div>
          <div class="modal-detail-row"><span class="modal-detail-label">Location</span><span>${inst.location?.fullAddress ?? `${inst.location?.district}, ${inst.location?.state}`}</span></div>
          <div class="modal-detail-row"><span class="modal-detail-label">Plan</span><span class="badge badge-primary">${inst.subscription?.plan ?? '—'}</span></div>
          <div class="modal-detail-row"><span class="modal-detail-label">Status</span><span class="badge ${inst.subscription?.status==='active'?'badge-success':'badge-error'}">${inst.subscription?.status ?? '—'}</span></div>
          <div class="modal-detail-row"><span class="modal-detail-label">Total Students</span><span>${stats?.totalStudents ?? '—'}</span></div>
          <div class="modal-detail-row"><span class="modal-detail-label">Total Events</span><span>${stats?.totalEvents ?? '—'}</span></div>
          <div class="modal-detail-row"><span class="modal-detail-label">Registered</span><span>${inst.createdAt ? new Date(inst.createdAt).toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric'}) : '—'}</span></div>
        `;
      } catch(e) {
        document.getElementById('instModalBody').innerHTML = `<p style="color:#ef4444;padding:20px;text-align:center;">Could not load: ${e.message}</p>`;
      }
    }

    async function suspendInst(id) {
      if (!confirm('Suspend this institution?')) return;
      try {
        const r = await fetch(`${API_BASE}/super-admin/institutions/${id}/suspend`, { method:'PUT', headers: authHeaders() });
        r.ok ? (alert('Suspended.'), loadInstitutions()) : alert('Failed.');
      } catch(e) { alert(e.message); }
    }

    async function activateInst(id) {
      if (!confirm('Activate this institution?')) return;
      try {
        const r = await fetch(`${API_BASE}/super-admin/institutions/${id}/activate`, { method:'PUT', headers: authHeaders() });
        r.ok ? (alert('Activated.'), loadInstitutions()) : alert('Failed.');
      } catch(e) { alert(e.message); }
    }

    /* ════════════════════════════════════════════════════════════════
       ANALYTICS
    ════════════════════════════════════════════════════════════════ */
    const chartInstances = {};

    function cssVar(n) { return getComputedStyle(document.documentElement).getPropertyValue(n).trim(); }

    function chartDefaults() {
      const text = cssVar('--text-secondary') || '#64748b';
      const grid = cssVar('--border')         || '#e2e8f0';
      return {
        responsive: true,
        plugins: { legend: { labels: { color: text } } },
        scales: { x: { ticks:{color:text}, grid:{color:grid} }, y: { ticks:{color:text}, grid:{color:grid} } }
      };
    }

    function revealChart(skId, canvasId) {
      document.getElementById(skId).style.display    = 'none';
      document.getElementById(canvasId).style.display = 'block';
    }
    function killChart(key) {
      if (chartInstances[key]) { chartInstances[key].destroy(); delete chartInstances[key]; }
    }

    async function loadAnalytics() {
      document.getElementById('analyticsBanner').classList.remove('show');
      ['Inst','Stu','Cat','Diff'].forEach(id => {
        document.getElementById('sk'+id).style.display = 'block';
        document.getElementById(id.charAt(0).toLowerCase()+id.slice(1)+'Chart').style.display = 'none';
      });

      try {
        const r    = await fetch(`${API_BASE}/super-admin/analytics`, { headers: authHeaders() });
        if (!r.ok) throw new Error(`Server error ${r.status}`);
        const data = await r.json();
        const defs = chartDefaults();
        const text = cssVar('--text-secondary') || '#64748b';

        // KPIs
        if (data.overview) {
          const ov = data.overview;
          document.getElementById('analyticsKPIs').innerHTML = `
            <div class="stat-card">
              <h3><i class="fa fa-building-columns"></i> Total Institutions</h3>
              <div class="stat-value">${ov.totalInstitutions ?? '—'}</div>
              <div class="stat-label">Registered</div>
            </div>
            <div class="stat-card green">
              <h3><i class="fa fa-users"></i> Total Students</h3>
              <div class="stat-value">${(ov.totalStudents ?? 0).toLocaleString()}</div>
              <div class="stat-label">Platform-wide</div>
            </div>
            <div class="stat-card amber">
              <h3><i class="fa fa-calendar-check"></i> Total Events</h3>
              <div class="stat-value">${ov.totalEvents ?? '—'}</div>
              <div class="stat-label">All-time</div>
            </div>
            <div class="stat-card purple">
              <h3><i class="fa fa-circle-question"></i> Question Bank</h3>
              <div class="stat-value">${ov.totalQuestions ?? '—'}</div>
              <div class="stat-label">Total questions</div>
            </div>
          `;
          // Health
          const active = ov.activeInstitutions ?? 0;
          const total  = ov.totalInstitutions  ?? 1;
          const pct    = total ? Math.round((active/total)*100) : 0;
          document.getElementById('healthRows').innerHTML = `
            <div class="stat-row"><span class="stat-row-label">Active rate</span><span class="stat-row-value">${pct}% <span class="badge-pill up">${active} active</span></span></div>
            <div class="stat-row"><span class="stat-row-label">Suspended</span><span class="stat-row-value">${ov.suspendedInstitutions??0} <span class="badge-pill ${(ov.suspendedInstitutions??0)>0?'down':'up'}">${(ov.suspendedInstitutions??0)>0?'needs review':'all clear'}</span></span></div>
            <div class="stat-row"><span class="stat-row-label">Total students</span><span class="stat-row-value">${(ov.totalStudents??0).toLocaleString()}</span></div>
            <div class="stat-row"><span class="stat-row-label">Total questions</span><span class="stat-row-value">${(ov.totalQuestions??0).toLocaleString()}</span></div>
            <div class="stat-row"><span class="stat-row-label">Total events</span><span class="stat-row-value">${(ov.totalEvents??0).toLocaleString()}</span></div>
          `;
        }

        // Top institutions table
        const topList = data.topInstitutions ?? [];
        renderTopTable(topList);

        // Institution Growth chart
        const instRows = data?.growth?.institutions ?? [];
        revealChart('skInst', 'instChart'); killChart('inst');
        if (instRows.length) {
          chartInstances.inst = new Chart(document.getElementById('instChart'), {
            type: 'line',
            data: {
              labels: instRows.map(d => d._id),
              datasets: [{ label:'Institutions', data: instRows.map(d => d.count), borderColor:'#3b82f6', backgroundColor:'rgba(59,130,246,0.1)', tension:0.4, fill:true, pointBackgroundColor:'#3b82f6', pointRadius:4 }]
            },
            options: defs
          });
        }

        // Student Growth chart
        const stuRows = data?.growth?.students ?? [];
        revealChart('skStu', 'stuChart'); killChart('stu');
        if (stuRows.length) {
          chartInstances.stu = new Chart(document.getElementById('stuChart'), {
            type: 'line',
            data: {
              labels: stuRows.map(d => d._id),
              datasets: [{ label:'Students', data: stuRows.map(d => d.count), borderColor:'#10b981', backgroundColor:'rgba(16,185,129,0.1)', tension:0.4, fill:true, pointBackgroundColor:'#10b981', pointRadius:4 }]
            },
            options: defs
          });
        }

        // Category doughnut
        const catRows = data?.questionBank?.byCategory ?? [];
        revealChart('skCat', 'catChart'); killChart('cat');
        if (catRows.length) {
          chartInstances.cat = new Chart(document.getElementById('catChart'), {
            type: 'doughnut',
            data: {
              labels: catRows.map(d => d._id),
              datasets: [{ data: catRows.map(d => d.count), backgroundColor:['#3b82f6','#10b981','#f59e0b','#ef4444','#8b5cf6','#06b6d4'], borderWidth:0 }]
            },
            options: { responsive:true, plugins:{ legend:{ labels:{ color:text } } } }
          });
        }

        // Difficulty bar
        const diffRows = data?.questionBank?.byDifficulty ?? [];
        revealChart('skDiff', 'diffChart'); killChart('diff');
        if (diffRows.length) {
          chartInstances.diff = new Chart(document.getElementById('diffChart'), {
            type: 'bar',
            data: {
              labels: diffRows.map(d => d._id),
              datasets: [{ label:'Questions', data: diffRows.map(d => d.count), backgroundColor:['#10b981','#f59e0b','#ef4444'], borderRadius:6 }]
            },
            options: defs
          });
        }

      } catch(e) {
        document.getElementById('analyticsErr').textContent = 'Failed to load analytics: ' + e.message;
        document.getElementById('analyticsBanner').classList.add('show');
        ['Inst','Stu','Cat','Diff'].forEach(id => document.getElementById('sk'+id).style.display = 'none');
      }
    }

    function renderTopTable(institutions) {
      const el = document.getElementById('topInstTable');
      if (!institutions?.length) { el.innerHTML = '<p style="text-align:center;padding:24px;color:var(--text-secondary);">No data available.</p>'; return; }
      const rankClass = i => ['gold','silver','bronze'][i] ?? '';
      el.innerHTML = `
        <div style="overflow-x:auto;">
        <table class="data-table">
          <thead>
            <tr>
              <th>Rank</th>
              <th>Institution</th>
              <th>Plan</th>
              <th>Status</th>
              <th>Joined</th>
            </tr>
          </thead>
          <tbody>
            ${institutions.slice(0,10).map((inst,i) => `
            <tr>
              <td><span class="rank-num ${rankClass(i)}">${i+1}</span></td>
              <td>
                <div style="font-weight:700;">${inst.name}</div>
                <div style="font-size:12px;color:var(--text-secondary);">${inst.email??''}</div>
              </td>
              <td><span class="badge-pill neutral">${inst.subscription?.plan??'—'}</span></td>
              <td><span class="badge ${inst.subscription?.status==='active'?'badge-success':'badge-error'}">${inst.subscription?.status??'—'}</span></td>
              <td style="font-size:13px;">${inst.createdAt ? new Date(inst.createdAt).toLocaleDateString('en-US',{year:'numeric',month:'short',day:'numeric'}) : '—'}</td>
            </tr>`).join('')}
          </tbody>
        </table>
        </div>
      `;
    }

    /* ════════════════════════════════════════════════════════════════
       CONTENT
    ════════════════════════════════════════════════════════════════ */
    document.querySelectorAll('.content-tab').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.content-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.content-panel').forEach(p => p.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.panel).classList.add('active');
      });
    });

    async function saveContent(type) {
      const idMap = { studentTerms:'studentTermsContent', instituteTerms:'instituteTermsContent', privacy:'privacyContent', faqs:'faqsContent' };
      const content = document.getElementById(idMap[type]).value;
      try {
        const r = await fetch(`${API_BASE}/super-admin/settings`, {
          method: 'PUT',
          headers: { ...authHeaders(), 'Content-Type':'application/json' },
          body: JSON.stringify({ key: type, value: content })
        });
        r.ok ? alert(`${type} saved successfully!`) : alert('Failed to save.');
      } catch(e) { alert('Error: ' + e.message); }
    }

    async function loadAllContent() {
      try {
        const r = await fetch(`${API_BASE}/super-admin/settings`, { headers: authHeaders() });
        if (!r.ok) return;
        const settings = await r.json();
        const idMap = { studentTerms:'studentTermsContent', instituteTerms:'instituteTermsContent', privacy:'privacyContent', faqs:'faqsContent' };
        settings.forEach(s => {
          const el = document.getElementById(idMap[s.key]);
          if (el) el.value = s.value;
        });
      } catch(e) { console.error('Content load error:', e); }
    }

    /* ── Auth header helper ───────────────────────────────────────── */
    function authHeaders() {
      return { 'Authorization': `Bearer ${authToken}` };
    }

    /* ── Initial load ─────────────────────────────────────────────── */
    pageLoaded.dashboard = true;
    loadDashboard();
  </script>
</body>
</html>